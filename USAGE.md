# Git合并助手 - 使用说明

## 🚀 快速开始

### 1. 准备工作
在使用插件之前，请确保：
- ✅ 已在VSCode中打开一个Git项目文件夹
- ✅ 当前项目是有效的Git仓库（包含.git文件夹）
- ✅ 已配置Git用户信息（git config user.name 和 user.email）
- ✅ 有权限访问远程仓库

### 2. 启动插件
1. 按 `F5` 启动扩展开发主机
2. 在新打开的VSCode窗口中，打开一个Git项目
3. 插件会自动激活并显示"Git合并助手已准备就绪！"

### 3. 使用命令

#### 方法一：命令面板
1. 按 `Ctrl+Shift+P`（Mac: `Cmd+Shift+P`）
2. 输入"Git合并助手"
3. 选择需要的命令：
   - **合并Feature分支** - 完整的自动化合并流程
   - **快速提交并合并** - 快速提交当前更改
   - **配置管理** - 管理插件配置

#### 方法二：Git面板
在VSCode左侧的源代码管理面板中，点击工具栏上的合并按钮

## ⚙️ 配置管理

### 配置管理功能
插件提供了灵活的配置管理功能，支持自定义主分支和目标分支。

#### 访问配置管理
1. 按 `Ctrl+Shift+P` 打开命令面板
2. 输入 "Git合并助手: 配置管理"
3. 选择配置操作

#### 配置选项

**1. 设置主分支**
- 选择使用 `main` 或 `master` 作为主分支
- 支持自动检测远程仓库的主分支

**2. 管理目标分支**
- 查看当前配置的目标分支
- 添加新的目标分支（如dev、staging、prod等）
- 删除不需要的目标分支

**3. 切换自动检测**
- 开启/关闭主分支自动检测功能
- 开启时会优先检测远程仓库的主分支名称

**4. 重置为默认配置**
- 一键恢复所有配置为默认值

### 配置示例

#### 添加新的目标分支
1. 选择"配置管理" → "管理目标分支" → "添加新分支"
2. 输入分支名称，如：`dev`
3. 输入分支描述，如：`开发环境`
4. 确认添加

#### 设置主分支
1. 选择"配置管理" → "设置主分支"
2. 选择 `main` 或 `master`
3. 配置会立即生效

### 手动配置
您也可以通过VSCode设置或settings.json手动配置：

```json
{
  "gitMergeHelper.mainBranch": "main",
  "gitMergeHelper.autoDetectMainBranch": true,
  "gitMergeHelper.targetBranches": [
    {
      "name": "dev",
      "description": "开发环境"
    },
    {
      "name": "uat",
      "description": "测试环境"
    },
    {
      "name": "pre",
      "description": "预发布环境"
    },
    {
      "name": "prod",
      "description": "生产环境"
    }
  ]
}
```

## 📋 详细流程

### 合并Feature分支流程

1. **环境检查**
   - 检查是否在Git仓库中
   - 检查当前分支是否为feature分支
   - 检查是否有未提交的更改

2. **处理未提交更改**
   - 如果有未提交更改，会询问是否现在提交
   - 输入提交信息（会自动添加"feat:"前缀）

3. **主分支检测**
   - 自动检测或使用配置的主分支（main/master）
   - 显示检测到的主分支名称

4. **选择目标分支**
   - 从配置的目标分支列表中选择
   - 默认包含uat和pre，可通过配置管理添加更多

5. **执行合并**
   - 更新主分支
   - 将主分支合并到当前feature分支
   - 将feature分支合并到目标分支
   - 切回原始分支

### 快速提交并合并

1. **检查更改**
   - 检查是否有未提交的更改
   - 如果没有更改，会提示并结束

2. **提交更改**
   - 输入提交信息
   - 自动执行git add和git commit

3. **可选合并**
   - 询问是否继续执行完整的合并流程

## ⚠️ 注意事项

### 使用前检查
- 确保在feature分支上操作
- 确保有主分支和目标分支的访问权限
- 建议在合并前先测试代码
- 首次使用建议先配置主分支和目标分支

### 配置建议
- **自动检测主分支**：建议保持开启，可自动适应不同项目
- **目标分支配置**：根据项目实际情况配置，常见的有：
  - `dev`：开发环境
  - `uat`：用户验收测试环境
  - `pre`：预发布环境
  - `staging`：预发布环境
  - `prod`：生产环境

### 错误处理
如果遇到以下错误：

**"请先打开一个工作区文件夹"**
- 解决方案：在VSCode中打开一个项目文件夹

**"当前工作区不是Git仓库"**
- 解决方案：确保项目根目录包含.git文件夹

**"当前不在feature分支上"**
- 解决方案：切换到feature分支后再运行

**"Git命令执行失败"**
- 检查网络连接
- 检查Git配置
- 检查分支权限

**"检测到主分支: undefined"**
- 解决方案：通过配置管理手动设置主分支

### 冲突处理
如果合并过程中出现冲突：
1. 插件会停止执行
2. 手动解决冲突
3. 完成合并后重新运行插件

## 🔧 故障排除

### 常见问题

**Q: 插件无法启动**
A: 检查是否正确编译了代码（npm run compile）

**Q: 找不到命令**
A: 确保插件已正确激活，检查命令面板中是否有"Git合并助手"分类

**Q: Git命令失败**
A: 检查Git配置和网络连接，确保有仓库访问权限

**Q: 分支切换失败**
A: 确保没有未保存的文件，检查分支是否存在

**Q: 配置不生效**
A: 检查配置是否正确保存，尝试重启VSCode

**Q: 目标分支列表为空**
A: 通过配置管理添加目标分支，或重置为默认配置

### 调试模式
如果需要调试：
1. 打开开发者工具（Help > Toggle Developer Tools）
2. 查看控制台输出
3. 检查错误信息

## 📞 获取帮助

如果遇到问题：
1. 查看VSCode输出面板的错误信息
2. 检查开发者工具控制台
3. 确认Git仓库状态和权限
4. 检查插件配置是否正确
5. 参考本文档的故障排除部分 

## 📦 如何打包发布：

### 准备工作
确保已安装所有依赖：
```bash
npm install
```

### 打包为.vsix文件
```bash
npx @vscode/vsce package
```

如果遇到"'vsce' 不是内部或外部命令"错误，请尝试：
```bash
# 方法1：使用npx确保安装
npx --yes @vscode/vsce package

# 方法2：全局安装vsce
npm install -g @vscode/vsce
vsce package
```

### 安装到VSCode
```bash
code --install-extension git-merge-helper-1.0.0.vsix
```

### 常见打包问题
- **缺少repository字段**：已在package.json中添加
- **缺少LICENSE文件**：已创建MIT许可证
- **包含不必要文件**：已创建.vscodeignore文件优化